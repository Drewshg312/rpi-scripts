---
- name: '[Linux] Include all linux-specific variables'
  include_vars: linux.yml

# To do something only if some distro installed on the host
# Even specific distro version can be specified, see:
# https://raymii.org/s/tutorials/Ansible_-_Only_if_on_specific_distribution_or_distribution_version.html
# example:
#     when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'
#
- name: '[Linux] Install mpd package'
  action: >
    {{ ansible_pkg_mgr }} name=mpd state=latest update_cache=yes

- name: '[Linux] Enable and Start mpd service if needed'
  service:
    name: mpd
    enabled: "{{ mpd_autostart }}"
    state: "{% if mpd_autostart %}started{% else %}stopped{% endif %}"
  become: yes

- name: '[Linux] Enable mpd socket if needed'
  service:
    name: mpd.socket
    enabled: "{% if mpd_autostart %}no{% else %}yes{% endif %}"
    state: "{% if mpd_autostart %}stopped{% else %}started{% endif %}"
  become: yes

- name: '[Linux] Generate mpd.conf from template'
  template:
    src: mpd.conf.j2
    dest: /etc/mpd.conf
    backup: yes
    owner: root
    group: root
    mode: 0644
  notify: Restart mpd service
  become: yes

- stat: path=/usr/sbin/firewalld
  register: mpd_stat_1_firewalld

- stat: path=/sbin/firewalld
  register: mpd_stat_2_firewalld

- name: '[Linux] Open mpd port in firewall'
  firewalld:
    port: "{{ mpd_port }}/tcp"
    zone: "{{ item }}"
    permanent: true
    immediate: yes
    state: enabled
  with_items: "{{ mpd_firewall_zones }}"
  become: yes
  when: mpd_stat_1_firewalld.stat.exists or mpd_stat_2_firewalld.stat.exists
...
